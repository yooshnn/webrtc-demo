# Development Environment
# Usage: docker-compose up --build

services:
  # Python gRPC Server (AI processing)
  ai:
    build:
      context: ./apps/ai
      dockerfile: Dockerfile
    container_name: webrtc-ai
    ports:
      - "50051:50051"
    environment:
      - PYTHONUNBUFFERED=1

  # Go WebRTC Server
  media:
    build:
      context: ./apps/media
      dockerfile: Dockerfile
    container_name: webrtc-media
    ports:
      - "8080:8080"
      - "50000-50050:50000-50050/udp"
    volumes:
      - ./temp_hls:/app/hls
    environment:
      - AI_SERVER_ADDR=ai:50051
    depends_on:
      - ai

  # React Router v7 + Vite Frontend
  client:
    build:
      context: ./apps/client
      dockerfile: Dockerfile
      target: dev
    container_name: webrtc-client
    ports:
      - "5173:5173"
    volumes:
      - ./temp_hls:/app/public/hls
      - ./apps/client:/app # Hot reload
      - client_node_modules:/app/node_modules # Isolate from host
    stdin_open: true
    tty: true
    depends_on:
      - media

volumes:
  client_node_modules: # Persist container node_modules
